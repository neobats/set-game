// Generated by ReScript, PLEASE EDIT WITH CARE

import * as Deck from "../play/Deck.res.mjs";
import * as Belt_Array from "@rescript/runtime/lib/es6/Belt_Array.js";
import * as Stdlib_List from "@rescript/runtime/lib/es6/Stdlib_List.js";
import * as Stdlib_Array from "@rescript/runtime/lib/es6/Stdlib_Array.js";
import * as Stdlib_Option from "@rescript/runtime/lib/es6/Stdlib_Option.js";

function init() {
  return /* [] */0;
}

let ListCollection = {
  length: Stdlib_List.length,
  add: Stdlib_List.add,
  map: Stdlib_List.map,
  toArray: Stdlib_List.toArray,
  init: init
};

function MakeGameSet(C) {
  return Collection => {
    let inspect = cards => {
      console.log("Cards", cards);
      return cards;
    };
    let maybeSet = cards => {
      let match = Collection.length(cards);
      if (match !== 0) {
        if (match !== 3) {
          return {
            TAG: "Filling",
            _0: cards
          };
        } else {
          return {
            TAG: "Filled",
            _0: cards
          };
        }
      } else {
        return "Empty";
      }
    };
    let add = (cards, card) => {
      console.log("Adding card", card);
      let length = Collection.length(cards);
      console.log("Length", length);
      if (length !== 3) {
        return Collection.add(cards, card);
      } else {
        return cards;
      }
    };
    let toSet = (s, _l) => {
      while (true) {
        let l = _l;
        if (l === 0) {
          return s;
        }
        s.add(l.hd);
        _l = l.tl;
        continue;
      };
    };
    let checkShapes = cards => {
      let shapes = toSet(new Set(), Stdlib_List.map(cards, card => card.shape));
      let match = shapes.size;
      if (match !== 1 && match !== 3) {
        return "Invalid";
      } else {
        return "Valid";
      }
    };
    return {
      length: Collection.length,
      map: Collection.map,
      toArray: Collection.toArray,
      make: Collection.init,
      inspect: inspect,
      maybeSet: maybeSet,
      add: add,
      toSet: toSet,
      checkShapes: checkShapes
    };
  };
}

function inspect(cards) {
  console.log("Cards", cards);
  return cards;
}

function maybeSet(cards) {
  let match = Stdlib_List.length(cards);
  if (match !== 0) {
    if (match !== 3) {
      return {
        TAG: "Filling",
        _0: cards
      };
    } else {
      return {
        TAG: "Filled",
        _0: cards
      };
    }
  } else {
    return "Empty";
  }
}

function add(cards, card) {
  console.log("Adding card", card);
  let length = Stdlib_List.length(cards);
  console.log("Length", length);
  if (length !== 3) {
    return Stdlib_List.add(cards, card);
  } else {
    return cards;
  }
}

function toSet(s, _l) {
  while (true) {
    let l = _l;
    if (l === 0) {
      return s;
    }
    s.add(l.hd);
    _l = l.tl;
    continue;
  };
}

function checkShapes(cards) {
  let shapes = toSet(new Set(), Stdlib_List.map(cards, card => card.shape));
  let match = shapes.size;
  if (match !== 1 && match !== 3) {
    return "Invalid";
  } else {
    return "Valid";
  }
}

let GameSet = {
  length: Stdlib_List.length,
  map: Stdlib_List.map,
  toArray: Stdlib_List.toArray,
  make: init,
  inspect: inspect,
  maybeSet: maybeSet,
  add: add,
  toSet: toSet,
  checkShapes: checkShapes
};

function test() {
  let deck = Belt_Array.shuffle(Deck.init());
  console.log("Deck", deck);
  let cards = deck.slice(0, 3);
  let set = Stdlib_Array.reduce([
    0,
    1,
    2
  ], init(), (set, i) => {
    let card = Stdlib_Option.getOrThrow(cards[i], undefined);
    console.log("From array: Card", card);
    return add(inspect(set), card);
  });
  let status = maybeSet(set);
  console.log("Status", status);
  if (typeof status !== "object") {
    console.log("Set empty");
  } else if (status.TAG === "Filling") {
    console.log("Set filling", status._0);
  } else {
    console.log("Set filled", status._0);
  }
  let c = checkShapes(Stdlib_List.fromArray(cards));
  if (c === "Valid") {
    console.log("Valid");
  } else {
    console.log("Invalid");
  }
  let check = c;
  console.log("Check", check);
}

export {
  ListCollection,
  MakeGameSet,
  GameSet,
  test,
}
/* No side effect */
